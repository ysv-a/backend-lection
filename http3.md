# Состояние: Cookies и сессии

HTTP cookie (web cookie, куки браузера) - это небольшой фрагмент данных, который сервер отправляет браузеру пользователя. Браузер может сохранить этот фрагмент у себя и отправлять на сервер с каждым последующим запросом. Это, в частности, позволяет узнать, с одного ли браузера пришли несколько запросов (например, для аутентификации пользователя). С помощью кук можно сохранить любую информацию о состоянии, HTTP-протокол сам по себе этого делать не умеет.

Cookies - Cookie представляет собой небольшой фрагмент произвольных текстовых данных, который может передаваться в теле HTTP-запросов и ответов, а также сохраняться в специальных файлах на устройстве пользователя

Файлы cookies изначально предназначены для улучшения удобства использования интернет-браузера. Со временем куки стали также использоваться и для других целей , таких, как сбор статистики использования сайта для таргетированной рекламы либо анализа работы сайта.

Куки часто используются для:

- Управления сеансом (логины, корзины для виртуальных покупок)
- Персонализации (пользовательские предпочтения)
- Трекинга (отслеживания поведения пользователей)

## Параметры:

path - URL-префикс пути, куки будут доступны для страниц под этим путём. Должен быть абсолютным. По умолчанию используется текущий путь.

domain - Домен определяет, где доступен файл куки. (*.site.com)

expires, max-age - По умолчанию, если куки не имеют ни одного из этих параметров, то они удалятся при закрытии браузера. Такие куки называются сессионными («session cookies»).

secure - Куки следует передавать только по HTTPS-протоколу.

httpOnly - Эта настройка запрещает любой доступ к куки из JavaScript.

samesite используется браузерами для определения того, как следует обрабатывать основные и сторонние файлы cookie. Браузеры могут разрешать или блокировать такие файлы cookie в зависимости от атрибута и сценария.

samesite=strict - Куки с samesite=strict никогда не отправятся, если пользователь пришёл не с этого же сайта.

samesite=lax - Режим Lax так же, как и strict, запрещает браузеру отправлять куки, когда запрос происходит не с сайта, но добавляет одно исключение.

```
setcookie("key", "value", [
    'expires' => time(),
    'path' => '/',
    'domain' => '',
    'secure' => true,
    'httpOnly' => true
    'samesite' => 'lax'
]);
```

# Сессии

Сессии реализуются на основе cookies.

Необходимость в куках обусловлена рядом задач, которые сложно или невозможно решить на основе «чистого» HTTP/HTML. Наиболее важная их которых — это реализация логики сессий. Предположим, вы зарегистрировались в каком-то интернет-магазине. Для совершения покупок вам необходимо войти в свой аккаунт (залогиниться), выбрать товары, добавить их в корзину, затем оформить заказ.

Логика организации сессий на основе куков выглядит следующим образом:

1. Пользователь открывает страницу авторизации сайта, вводит свой логин и пароль, которые затем отправляются на сервер.
2. Сервер получает логин и пароль. Выполняет авторизацию. Если она прошла успешно, создает сессию и возвращает на сторону пользователя в HTTP-ответе уникальный идентификатор сессии
3. Браузер, получив в ответе от сервера идентификатор сессии, локально сохраняет его в cookie-файл на устройстве пользователя. И далее каждый раз, когда пользователь инициирует запрос к этому сайту, в параметре «Cookie» HTTP-запроса будет отправляться идентификатор сессии.
4. Сервер, получив идентификатор сессии, автоматически проводит авторизацию пользователя и связывает его с активной сессией.

# Архитектура для http

Чистая архитектура для http, полное разделение пользователей др. от друга

![alt](https://i.gyazo.com/e8ebf6876ca1c57b9409d1d643f9963f.png)

![alt](https://i.gyazo.com/3950d4f157ba568d94938baa0e9dddb6.png)

# REST:

REST (Representational State Transfer)  — это способ создания API с помощью протокола HTTP.

На русском его называют «передачей состояния представления».

REST API — это способ взаимодействия сайтов и веб-приложений с сервером. Его также называют RESTful.

- Клиент серверная архитектура (HTTP)
- Stateless
- Кэширование
- Единообразие интерфейса
- Layered system

Stateless - не использование глобального состояния, глобального стейта на сервере

Принцип заключается в том, что сервер не должен хранить у себя информацию о сессии с клиентом. Он должен в каждом запросе получать всю информацию для обработки.

Stateful - В этом случае сервер хранит информацию о предыдущих обращениях клиента, хранит информацию о сессии, какую-то часть контекста взаимодействия с клиентом. А затем может использовать эту информацию при обработке следующих запросов.

# Сохранение данных в браузере

![alt](https://i.gyazo.com/55ae1ebb0e8db062a1329fc1d9dbfd81.png)

![alt](https://i.gyazo.com/0fb36aa344ffd8ec22d20ce5438f5086.png)


# Сессии

![alt](https://i.gyazo.com/133a9a35bc6e9fdaab574ba4ae5f6eb4.png)

![alt](https://i.gyazo.com/86a1d2a5fd103cb285c8a63d7c36c5f0.png)

![alt](https://i.gyazo.com/b9f4e5390c49fc493b45854c92b8f076.png)

# Аутентификации

![alt](https://i.gyazo.com/2781b308e7e61d8b742ce83d54eae416.png)

![alt](https://i.gyazo.com/9eee1bf62b2e8505ea46f86fa0917de4.png)

## Basic Auth

![alt](https://i.gyazo.com/c10103cfdd47f26e14d8ea1b0bdc53f4.png)

```
<Directory "/var/www/html">
  AuthType Basic
  AuthName "Restricted Content"
  AuthUserFile /etc/apache2/.htpasswd
  Require valid-user
</Directory>
```

## Bearer Auth

![alt](https://i.gyazo.com/068485d9db7c8f8db6ca1282979abc68.png)

![alt](https://i.gyazo.com/31d803f57e86fa0c90c40544f09e2eba.png)

## Session Auth

![alt](https://i.gyazo.com/c10df3238beec8ea90f56115cb4fec60.png)

## Cookie Auth

![alt](https://i.gyazo.com/d9f4832f9f664ee1db17965f06df271e.png)
