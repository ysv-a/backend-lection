# CI - непрерывная интеграция

Непрерывная интеграция — практика разработки программного обеспечения, которая заключается в постоянном слиянии рабочих копий в общую основную ветвь разработки и выполнении частых автоматизированных сборок проекта для скорейшего выявления потенциальных дефектов и решения интеграционных проблем.

Когда сливаем наши наработки в основную ветку разработки как можно чаще и при этом максимально автоматизируя и контролируя их качество

(CI является неотъемлемой практикой экстремального программирования)

Разработчикам нужно получать фидбек, о том что система находится в потенциальной сломанном состоянии как можно раньше.

Для этого пишутся системы, которые запускают автоматизированные тесты, линтеры, форматеры кода, статические анализаторы, делают какие то дополнительные проверки и т.д

Если в проекте нет тестов, то ценность CI снижается.

## Ценность такой практики для бизнеса:

Программисты имеют больше уверренности в том, что продукт в каждый момент разработки находится в рабочем состояниии - это позволяет двигаться и итерироваться быстрее.

# CD - непрерывное развертывание

Это то как продукт попадает на сервера.

Применение CD позволяет компании итерироваться быстрее.

Чем быстрее фичи которые разрабатывают разработчики оказываются там, где их можно "пощупать", тем быстрее можно получить настоящий фидбек об их ценности и тем быстрее можно среагировать на изменяющиеся условия бизнеса.

## Incremental rollouts

Выпуская производственные изменения постепенно, можно отслеживать количество ошибок или снижение производительности, и, если проблем нет, можно обновить все модули.

# Как работает

![](https://i.gyazo.com/abf8529da77b73e09e9e099b2d9800f4.png)

Хранилище нашего исходного кода - git storage.

Координатор (например github actions), который занимается тем что отвечает за запуск всего.

Git storage умеет генерировать события (commit, push and etc).

В коде лежит файл с инструкциями (workflow), с описанием правил что делать когда происходят те или иные события (запустить тесты).

Инструкции разбиваются на набор шагов - jobs.

Runner каждое n-ое время стучаться к координатору и спрашивают есть ли что-то для выполнения задач, если задач ничего не делает.

Runner - железо/машина которая выполняет jobs.

![](https://i.gyazo.com/d5f0fd5a6cc02df43ba8a5a28ca16d53.png)

Если задачи есть, координатор Runner передает job, координатору также нужно передать набор Env (переменных окружений).

т.е координатор, будет передавать Runner, Jobs + Env.

Runner выполняет jobs (вытаскивает код приложения из хранилища), может выполнять параллельно несколько jobs, как только выполняется job, оповещает координатора на результат выполнения, успешно - неуспешно.

Job может сгенерировать набор файлов по итогу своей работы - артефакты - они загружаются на координатор.
(другой Runner может точно также выполнить другую job)

## Pipline

Pipline состоит из jobs

job  - это одна задача которая решает атомарную смысловую единицу (например задачи: прогнать eslint, стати. анализатор, запустить тесты)

Есть зависимости м\у jobs, т.е какая то job не должна выполнятся пока не выполнится зависимая

### Steps

Steps: это шаги внутри Job, которые нужно выполнять

Каждая job это несколько команд, которые начинаются с чистого листа

1. получение исходников проекта
2. настроить то, что мы собираемся запускать
3. выполнить команды

любая провалившая команда, которая вернула код возврата отличный от 0 будет говорить о провале CI

![](https://i.gyazo.com/602c198ce53bab1307348349ba9c9145.png)

## Типы

Ручные задачи (manual jobs)

Review App это способ развертывания ветки для просмотра приложения с изменениями этой ветки с возможностью обновления. Получить работающее изолированное приложение, чтобы другие члены команды могли попробовать его в бою.

## Ключевое в 12факторов

https://12factor.net/ru/

Есть приложение, и оно не должно изменятся в зависимости от того, где оно запускается т.е в вашем коде не должно быть настроек

![](https://i.gyazo.com/63bb414723593db5e40f837214d88be4.png)


http://82.148.16.149.nip.io/
